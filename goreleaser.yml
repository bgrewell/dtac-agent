# Goreleaser configuration
before:
  hooks:
    - go mod download

project_name: dtac-agentd
builds:
  -
    binary: dtac-agentd
    main: ./cmd/agent/main.go
    id: "dtac-agentd"
    goos:
      - linux
      - windows
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s -w -X github.com/bgrewell/dtac-agent/internal/version.version={{.Version}} -X github.com/bgrewell/dtac-agent/internal/version.rev={{.ShortCommit}} -X github.com/bgrewell/dtac-agent/internal/version.date={{.Date}} -X github.com/bgrewell/dtac-agent/internal/version.branch={{.Branch}}

  -
    binary: hello.plugin
    main: ./cmd/plugins/hello/main.go
    id: "hello"
    goos:
      - linux
      - windows
    goarch:
        - amd64

  -
    binary: dtac
    main: ./cmd/cli/main.go
    id: "dtac"
    goos:
      - linux
      - windows
    goarch:
      - amd64

# Set up the GitHub release
release:
  github:
    owner: bgrewell
    name: dtac-agent
  # If set to true, will not auto-publish the release.
  draft: false
  # If set to auto, will mark the release as not ready for production
  # in case there is an indicator for this in the tag e.g. v1.0.0-rc1
  # If set to true, will mark the release as not ready for production.
  # Default is false.
  prerelease: auto

# Define the .deb package
nfpms:
  - id: debian
    builds:
      - dtac-agentd
      - hello
      - dtac
    formats:
      - deb
    dependencies:
      - python3
      - python3-pip
    bindir: /opt/dtac/bin
    vendor: Intel
    homepage: https://software.labs.intel.com
    maintainer: Benjamin Grewell <benjamin.grewell@intel.com>
    description: The Distributed Telemetry and Advanced Control (DTAC) framework is a collection of projects designed to
      reduce the time to completion of software projects and testbeds by providing a highly reusable and extensible 
      framework for the collection of monitoring and manipulation of a wide variety of systems.
    license: MIT
    scripts:
      postinstall: ./scripts/debian/postinstall.sh
    contents:
      # Systemd service file
      - src: ./service/systemd/dtac-agentd.service
        dst: /lib/systemd/system/dtac-agentd.service
        file_info:
          mode: 0644
          owner: root
          group: root

  # Define the .rpm package
  - id: rpm
    builds:
      - dtac-agentd
      - hello
      - dtac
    formats:
      - rpm
    bindir: /usr/local/bin
    vendor: Intel
    homepage: https://software.labs.intel.com
    maintainer: Benjamin Grewell <benjamin.grewell@intel.com>
    description: The Distributed Telemetry and Advanced Control (DTAC) framework is a collection of projects designed to
      reduce the time to completion of software projects and testbeds by providing a highly reusable and extensible
      framework for the collection of monitoring and manipulation of a wide variety of systems.
    license: MIT
    scripts:
      postinstall: ./scripts/rhel/postinstall.sh
    contents:
      # Systemd service file
      - src: ./service/systemd/dtac-agentd.service
        dst: /lib/systemd/system/dtac-agentd.service
        file_info:
          mode: 0644
          owner: root
          group: root

#chocolateys:
#  -
#    name: dtac-agentd
#    ids: []
#    title: DTAC Agent
#    authors: Benjamin Grewell <benjamin.grewell@intel.com>
#    description: >-
#      The Distributed Telemetry and Advanced Control (DTAC) framework is a collection of projects designed to
#      reduce the time to completion of software projects and testbeds by providing a highly reusable and extensible
#      framework for the collection of monitoring and manipulation of a wide variety of systems.
#    project_url: https://software.labs.intel.com
#    dependencies: []
